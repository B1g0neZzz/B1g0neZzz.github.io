<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>makefile | 太一的博客 | 一个程序学徒</title>

  
  <meta name="author" content="太一">
  

  
  <meta name="description" content="Java 后端">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="makefile"/>

  <meta property="og:site_name" content="太一的博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="太一的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">太一的博客</a>
    </h1>
    <p class="site-description">一个程序学徒</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/categories">Categories</a></li>
      
        <li><a href="/tags">Tags</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>makefile</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/10/02/makefile/" rel="bookmark">
        <time class="entry-date published" datetime="2024-10-02T08:42:04.000Z">
          2024-10-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="make-工具"><a href="#make-工具" class="headerlink" title="make 工具"></a>make 工具</h1><ul>
<li>利用 <strong>make</strong>  工具可以自动完成编译工作。这些工作包括：如果仅修改了某几个源文件，则只重新编译这几个源文件；如果某个头文件被修改了，则重新编译所有包含该头文件的源文件。利用这种自动编译可大大简化开发工作，避免不必要的重新编译。</li>
<li><strong>make</strong> 工具通过一个称为 <strong>Makefile</strong> 的文件来完成并自动维护编译工作。<strong>Makefile</strong> 文件描述了整个工程的编译、链接等规则。</li>
</ul>
<h1 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h1><h2 id="基本规则"><a href="#基本规则" class="headerlink" title="基本规则"></a>基本规则</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TARGET ... : DEPENDENCIES ...</span><br><span class="line">	COMMAND</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<ul>
<li>目标（ <strong>TARGET</strong> ）程序产生的文件，如可执行文件和目标文件；目标也可以是要执行的动作，如 <strong>clean</strong>，也称为伪目标</li>
<li>依赖（ <strong>DEPENDENCIES</strong> ）是用来产生目标的输入文件列表，一个目标通常依赖于多个文件</li>
<li>命令（ <strong>COMMAND</strong> ）是 <strong>make</strong> 执行的动作（命令是 <strong>shell</strong> 命令或是可在 <strong>shell</strong> 下执行的程序）。注意：<strong>每个命令行的起始字符必须为 TAB 字符</strong></li>
<li>如果 <strong>DEPENDENCIES</strong> 中有一个或多个文件更新的话，<strong>COMMAND</strong> 就要执行，这就是 <strong>Makefile</strong> 最核心的内容</li>
</ul>
<h2 id="伪目标"><a href="#伪目标" class="headerlink" title="伪目标"></a>伪目标</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.PHONY:clean</span><br><span class="line">main:main.o add.o sub.o</span><br><span class="line">	gcc -Wall -g main.o add.o sub.o -o main</span><br><span class="line">main.o:main.c</span><br><span class="line">	gcc -Wall -g -c main.c -o main.o</span><br><span class="line">add.o:add.c add.h</span><br><span class="line">	gcc -Wall -g -c add.c -o add.o</span><br><span class="line">sub.o:sub.c sub.h</span><br><span class="line">	gcc -Wall -g -c sub.c -o sub.o</span><br><span class="line">clean:</span><br><span class="line">	rm -f main main.o add.o sub.o</span><br></pre></td></tr></table></figure>

<p>为什么要显式指定伪目标？</p>
<p>例如，如果当前文件夹下有clean，使用make clean就会：</p>
<p><img src="https://taiichi.oss-cn-beijing.aliyuncs.com/img/image-20241003113736167.png" alt="image-20241003113736167"></p>
<h2 id="Makefile-中的变量"><a href="#Makefile-中的变量" class="headerlink" title="Makefile 中的变量"></a>Makefile 中的变量</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$@	规则的目标文件名</span><br><span class="line">$&lt;	规则的第一个依赖文件名</span><br><span class="line">$^	规则的所有依赖文件列表</span><br></pre></td></tr></table></figure>



<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="keyword">.PHONY</span>:clean</span></span><br><span class="line">OBJECTS=main.o add.o sub.o</span><br><span class="line"><span class="section">main:<span class="variable">$(OBJECTS)</span></span></span><br><span class="line">	gcc -Wall -g <span class="variable">$^</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="section">main.o:main.c</span></span><br><span class="line">	gcc -Wall -g -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="section">add.o:add.c add.h</span></span><br><span class="line">	gcc -Wall -g -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="section">sub.o:sub.c sub.h</span></span><br><span class="line">	gcc -Wall -g -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -f main <span class="variable">$(OBJECTS)</span></span><br></pre></td></tr></table></figure>

<h3 id="Makefile-编译多个可执行文件"><a href="#Makefile-编译多个可执行文件" class="headerlink" title="Makefile 编译多个可执行文件"></a>Makefile 编译多个可执行文件</h3><ul>
<li><p>模式规则</p>
<ul>
<li><code>%.o:%.c</code></li>
</ul>
</li>
<li><p>后缀规则</p>
<ul>
<li><code>.c.o:</code></li>
</ul>
</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">.PYHONY:clean all</span></span><br><span class="line">CC=gcc</span><br><span class="line">CFLAGS=-Wall -g</span><br><span class="line">BIN=01test 02test 03test</span><br><span class="line"><span class="section">all:<span class="variable">$(BIN)</span></span></span><br><span class="line"><span class="section">%.o:%.c</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="section">01test:01test.o</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> <span class="variable">$^</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="section">02test:02test.o</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> <span class="variable">$^</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="section">03test:03test.o</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> <span class="variable">$^</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -f *.o <span class="variable">$(BIN)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="make常用内嵌函数"><a href="#make常用内嵌函数" class="headerlink" title="make常用内嵌函数"></a>make常用内嵌函数</h2><ul>
<li>函数调用<ul>
<li><code>$(function arguments)</code></li>
</ul>
</li>
<li><code>$(wildcard PATTERN)</code><ul>
<li>当前目录下匹配模式的文件</li>
<li>例如：<code>src=$(wildcard *.c)</code></li>
</ul>
</li>
<li><code>$(patsubst PATTERN,REPLACEMENT,TEXT)</code><ul>
<li>模式替换函数</li>
<li>例如：<code>$(patsubst %.c,%.o,$src)</code></li>
<li>等价于<code>$(sr:.c=.o)</code></li>
</ul>
</li>
<li><code>shell</code> 函数<ul>
<li>执行<code>shell</code>命令</li>
<li>例如：<code>$(shell ls -d */)</code></li>
</ul>
</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>

  









    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2025 太一
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>